app.get("/", async (req, res) => {
  res.type("html").send(`
    <h2>Upload</h2>
    <form action="/upload" method="post" enctype="multipart/form-data">
      <input type="file" name="file" />
      <button type="submit">Upload</button>
    </form>
    <hr/>
    <h2>Files</h2>
    <div id="list">Loading...</div>
    <script>
      fetch('/files').then(r=>r.json()).then(data=>{
        const el = document.getElementById('list');
        el.innerHTML = '';
        data.files.forEach(name=>{
          const wrap = document.createElement('div');
          wrap.style.marginBottom = '12px';
          const a = document.createElement('a');
          a.href = '/file/' + encodeURIComponent(name);
          a.textContent = name;
          a.target = '_blank';
          wrap.appendChild(a);

          if (name.match(/\\.(png|jpg|jpeg|gif|webp)$/i)) {
            const img = document.createElement('img');
            img.src = '/file/' + encodeURIComponent(name);
            img.style.display = 'block';
            img.style.maxWidth = '300px';
            img.style.marginTop = '6px';
            wrap.appendChild(img);
          }
          el.appendChild(wrap);
        });
      });
    </script>
  `);
});
